## Внимание

ПРОВЕРИТЬ НАПРАВЛЕНИЕ ВРАЩЕНИЯ ЗАКРЫТИЯ НА ДРАЙВЕРЕ! \
Положительное направление вращения - в сторону открытия клапана.

## Справочные параметры для ТРВ Danfoss ETS 24C-22 Colibri:

| Параметр                     | Описание
|------------------------------|------------
Тип шагового двигателя         | Биполярный с постоянными магниатми
Режим микрошага                | Микрошаг (рекомендуется), полный шаг или полушаг
Ток фазы                       | 800 мА в пике / 600 мА RMS
Ток удержания                  | Нет необходимости в токе удержания. Допускается маскимум 20% ток удержания при протекании хладагента через клапан. Для оптимальной работы необходимо, чтобы клапан поддерживал 100% ток в течение 10 мс после последнего шага.
Сопротивление фазы             | 10 Ω ±10% при +20 °C / +68 °F
Индуктивность                  | 14 mH ±25%
Рабочий цикл                   | допускается 100% при протекании халадгента через клапан. Рекомендуется: до 50% с паузой 120 сек.
Номинальное потребление        | 7.44 Вт RMS при 20 °C (полное на обе обмотки)
Общее количество полных шагов  | 600
Скорость                       | Рекомендуется: микрошаг (1:4 или больше) 240 полных шагов/сек. Полный шаг или полушаг: 240 полных шагов/сек. Аварийное закрытие: 240 полных шагов/сек.
Коэффициент преобразования     | 0.0167 мм / шаг
Время полного перемещения      | 2.5 с при 240 шагов/сек
Ход открытия                   | 10 мм / 0.4 дюйма
Начальное положение            | Полностью закрытое положение (после перегрузки)
Параметры перегрузки           | 1% (6 полных шагов) Для оптимальной производительности рекоменжуется выполнять перегрузку. Для начальной инициализации рекомендуется перегрузка 628 шагов в направлении закрытия. Перегрузка в открытом положении не рекомендуется.

## Карта Modbus регистров прибора

Регистр      | Бит | Название | Тип     | Modbus адрес | Доступ     | Назначение
-------------|-----|----------|---------|--------------|------------|-----------------------------------------
au16data[0]  | 0   | DT0      | coil    | 0            | read       | 1 - прибор готов, 0 - не готов
au16data[1]  | 0   | CL16     | coil    | 17           | read/write | 1 - выполнить перегрузку
au16data[1]  | 1   | CL17     | coil    | 18           | read/write | 1 - начать движение к целевой координате
au16data[1]  | 2   | CL18     | coil    | 19           | read/write | 1 - выполнить полную перегрузку
au16data[2]  |     | INPT3    | input   | 3            | read       | чтение текущего положения задвижки
au16data[3]  |     | INPT4    | input   | 4            | read       | чтение кода ошибки
au16data[5]  |     | HOLD6    | holding | 6            | read/write | записать целевую координату

## Коды ошибок (регистр кодов ошибок)
Обозначение        | Код | Описание
-------------------|-----|-----------------------------------------
ERR_NO             |  0  | Ошибок нет 
ERR_OVERLOAD       |  1  | Ошибка перегрузки
ERR_GO_TO_POS      |  2  | Ошибка перемещения в целевую координату
ERR_TOTAL_OVERLOAD |  3  | Ошибка полной перегрузки
ERR_INIT           |  4  | Ошибка инициализации

## Параметры привода
Обозначение                  | Значение по умолчанию | Описание
-----------------------------|-----------------------|-----------------------------------------
ENABLE_PIN           | 4 (D4)      | Номер пина, к которому подключен ENABLE pin драйвера
STEP_PIN             | 3 (D3)      | Номер пина, к которому подключен STEP pin драйвер
DIR_PIN              | 2 (D2)      | Номер пина, к которому подключен DIR pin драйвера
BUSY_PIN             | LED_BUILTIN | Номер пина, который сигнализирует о статусе занят/готов
VELOCITY             | 240         | Скорость в полных шагах в секунду
MICROSTEPS           | 32          | Делитель микрошага, установленный на драйвере
TOTAL_STEPS          | 600         | Полное рабочее число шагов БЕЗ учета микрошага
OVERDRIVE_STEPS      | 6           | Запас полных шагов перегрузки
INIT_OVERDRIVE_STEPS | 28          | Запас полных шагов перегрузки для первичной инициализации
HIGH_TIME            | 5           | Длительность состояния HIGH для STEP pin в микросекундах
MAX_REL_POSITION     | 1000        | Положение задвижки задатеся числом 0-X, где 0 - полностью закрыто, X - полностью открыто
HOLDING_TIME         | 10          | Время (в миллисекундах) до отключения питания обмоток после последнего шага
MODBUS_ADDR          | 1           | Адрес устройства в сети Modbus
MODBUS_TX_CONTROL    | 0           | Номер выхода управления TX
MODBUS_SPEED         | 9600        | Скорость передачи данных по RS-485